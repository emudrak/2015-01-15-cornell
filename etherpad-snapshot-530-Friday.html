<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
<meta http-equiv="Content-type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Language" content="en-us">
<title>/7XixtJSZJq</title>
</head>
<body><b>Welcome to Data Carpentry!</b><br><b>2015-01-14 Cornell</b><br><br>We'll
 use this etherpad during the workshop to take notes, have an informal 
way of asking questions, and keep track of links. Please fill in your 
name in the very top right (and feel free to pick a new color for 
yourself). You can write in this area to take notes, or feel free to ask
 questions, post comments, etc in the chat area.&nbsp;<br><br><b>Useful Links:</b><br>Homepage: <a href="http://emudrak.github.io/2015-01-15-cornell/">http://emudrak.github.io/2015-01-15-cornell/</a><br>Data: <a href="http://emudrak.github.io/2015-y01-15-cornell/data/biology/">http://emudrak.github.io/2015-y01-15-cornell/data/biology/</a><br>Cheat sheets: <a href="http://emudrak.github.io/2015-01-15-cornell/lessons/ref/index.html">http://emudrak.github.io/2015-01-15-cornell/lessons/ref/index.html</a><br>&nbsp;<br><br>Good morning carpenters! :)<br>I'm
 going to take notes as Jeremia is talking so hopefully no one ever gets
 too far behind. Feel free to ask questions on the fly in the little 
chat corner to the right.&nbsp;<br><br>Go to the data link above and download anything that ends with ".csv"<br>Put up a pink sticky if you're having any problems finding or downloading the csv files<br><br><br><b>Using Excel</b><br>We all use excel, how can we use excel in the best way possible?<br>The issue with excel is it's hard to do reproducible science using excel.<br><br>Open excel<br><br>Our
 goal for this first lesson on excel is to show you how to best store 
your data in excel so that it is easy to use that data later, either by 
passing it to analysis scripts or another person (including future you).<br><br>Some rules:<br>- Each cell should be one unit of information<br>- Each column should represent one variable<br>- Each row should be one observation<br>- Always better to store independent data in independent files<br><br>open species.csv and plots.csv in excel<br><br>Question:
 Why should you enter zeros rather than just leaving cells blank? Zeros 
are observations, blank means missing. If you leave zeros blank, you 
won't know whether those are missing values or zeros. Those are two 
different things!<br><br>How should we indicate nulls?<br>- -999<br>- .<br>- NA<br>- NULL<br>- leave things blank (problem: missing vs. not yet)<br><br>Some Dos and Don'ts<br>Don't enter unit, and it makes the data type to be "general"<br>Don't merge cells<br>Don't
 combine multiple readings in one column, for example [2 male, 3 female]
 (have a separate column for total males and total females)<br>Do keep headers short and without spaces, starting with numbers, or special characters<br>Be careful pasting from other programs into excel - especially word! <b>Paste special</b> and make sure formatting isn't carried over<br><br>Dates in excel<br>- There are many ways to format dates in excel<br>- If you change a date to a number, you'll see an odd number, and it's not clear how that relates to what you've entered.<br>- Excel counts up from Dec 31st 1899 by one for each day. This CAN change depending on your version of excel.&nbsp;<br>- If you're not careful, excel can sometimes export the number rather than the date you were expecting.&nbsp;<br>- Some testimonials of how excel dates have been jerks to us:&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 1. If you're working with historical data, you might run into errors 
(anything before start date gets "1")&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 2. If excel thinks some text is a date, it'll automatically convert 
this to a date. A common example is with gene names if you're working 
with genomic data. It'll recognize some gene names as dates and auto 
convert those to dates and then when you export it you're exporting 
something totally different than the gene name.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 3. My personal testimonial: I had data where I had people's birthday's 
and date of collection for some sample in two different columns. I 
needed to share my spreadsheet with a collaborator and did so using 
google spreadsheets. Google has a different way to deal with dates and 
it totally messed up all of those dates I had entered. When they 
calculated age at time of collection, some of the people were too young 
to be in the study and they thought I was doing something sketchy! I 
wasn't, it was just date issues! Don't let your collaborators think 
you're an idiot like I did!<br>- Use ISO format: 2015-01-15 (year, month, date), fix at text.<br><br>Challenge!
 In the surveys-exercise-extract_month.csv dataset, extract year and 
month and put those in their own individual columns. Once you're done, 
put up a blue sticky. If you're stuck, put up a pink sticky. How did you
 guys solve this?&nbsp;<br>Method 1: Select all the dates, text to 
columns under the data tab, make sure Delimited is checked, hit next, 
don't choose any delimiter, click next, under column data format, 
highlight Date and change to DMY. This converts them to date format, and
 our formula in the other cell works (=YEAR())<br><br>Download the aphid_data_Bahlai_2014.xlsx file from the data link<br>- Open up a blank page in a text editor -&gt; we're going to keep track of what we're doing<br>- Look across the second row. Some cells are filled in, others are derived.<br>-
 Let's save a copy as aphid_data_Bahlai_2014_visualize.xlsx so we can 
muck with it but still keep the original version of the data separate<br>- Let's copy all of the data and paste special (select values) so that the derived numbers are static<br>-
 If we want to do a sort on the data, we can go to Data -&gt; Sort. It 
should recoginize that we have headers on our columns, and we can pick 
what to sort by.&nbsp;<br>- Let's start by sorting males from smallest to largest. This is an easy way to look at outliers/extreme values<br>-
 Let's make a pivot table and compare some variables. You can go to the 
Analyze tab on Windows or the Data tab on Mac (at least my version) and 
click pivot table.&nbsp;<br><br>Soooo, pivot tables were fun...let's 
export our data so that we can use the data in other programs (for 
example, summarizing using R might be easier than using a pivot 
table).&nbsp;<br><br>You can go to 'Save As' and select a text format, 
either .csv (which will put commas in between the fields) or 
tab-delimited (puts tabs in between the fields). Click ok when it pops 
up a warning<br><br>What happens if we're saving as comma delimited, but
 there are commas in some of our cells? When you save from excel, it 
will put those cells in quotes, so that it won't split on that comma 
when read later.&nbsp;<br><br>Always use a csv, txt parser when you're 
opening up the file in another program. People have thought a lot about 
the issues that can crop up and have implemented solutions in those 
parsers.&nbsp;<br><br><br><br><br><b>Open Refine</b><br>Go to: <a href="http://openrefine.org/">http://openrefine.org/</a><br><br>If
 mac people are having any issues with where it's saying the program is 
broken, follow the instructions here to change security settings: <a href="https://github.com/OpenRefine/OpenRefine/issues/590">https://github.com/OpenRefine/OpenRefine/issues/590</a><br><br><a href="http://127.0.0.1:3333/">http://127.0.0.1:3333/</a>&nbsp;<br><br>Text facet is very helpful to merge similar data-- using text facet--cluster--methods--nearest neightbor--PPM<br><br>Numeric facet<br><br>Text transform<br>value.replace ("~", " ")<br><br>Multiple facets used at the same time.<br><br>Under
 endowment, we have numbers and we also have people that wrote "10 
billion", etc. How can we transform these so that we can actually work 
with it?<br>1. Get rid of "US $" stuff -&gt; under the 'text transform' for the endowment column:<br>value.replace("US $", "").replace("US$, "")<br>2. Let's do another text transform:<br>toNumber(value.replace(" million", ""))*1000000<br>---breaking that down:<br>-------toNumber: will transform this cell to be numeric rather than text<br>-------value.replace: will take any instance of " million" and replace it with nothing<br>-------*1000000:
 multiply the remaining value in the cell by one million. This gives us 
the actual value in dollars now in a numeric value.&nbsp;<br><br>We can also plot. Under endowment, you can click....shoot. I got behind...How do we pull up a plot?<br>Facet--scatterplot facet&nbsp;<br>Thanks :)<br><br>Under
 the Undo/Redo tab, you'll see a history of the steps you've taken to 
transform your code. You can extract this history and you can reapply 
the same steps to other files.&nbsp;<br><br>What you're doing isn't 
changing your original data, you must click the export button and that 
will save your edited table. This table can be opened in excel, R, 
whatever program you want.&nbsp;<br><br>LUNCH!!! Be back by 1:30!<br><br><br><br><br><b>SQL</b><br>Welcome back from lunch. This afternoon we'll be learning a databasing language: SQL.<br>Make sure you still have the species.csv, plots.csv, and surveys.csv available.&nbsp;<br><br>Open survey.csv in Excel to look at it. Then close it again...<br><br>Install SQLite manager in firefox. Go to course webpage: <a href="http://emudrak.github.io/2015-01-15-cornell/">http://emudrak.github.io/2015-01-15-cornell/</a><br>Open
 the menu on firefox.&nbsp; It should be in upper right corner as 3 
bars.&nbsp; Click on add-ons, search for SQLite.&nbsp; Pick SQLite 
Manager 0.8.1.&nbsp; Restart Firefox.&nbsp;<br><br>To Open SQLite 
Manger, look under the tools menubar.&nbsp; If you can't find the menu 
listed with "File | Edit | View | History | Bookmarks | Tools | Help|", 
Right-click on the blue area above the tabs, and show the menu bar by 
making sure that "Menu bar" is clicked. Then you should be able to look 
under the "Tools" menu bar.&nbsp;<br><br>*Make a new database*<br>DataBase --&gt; New Database.&nbsp; Call it Mammal_survey.&nbsp; Save it in the same folder ("DC_Workshop").&nbsp;<br><br>*Import a File*&nbsp;<br>Database
 --&gt; Import.&nbsp; Select CSV, Use Select file to browse to your 
file. This time, choose plots.csv and click open.&nbsp; Make sure it 
will process the file correctly: Choose "First row contains column 
names" and Fields separated by column.&nbsp;<br><br>A new table called plots will be created. Say OK here.&nbsp;<br>The Create Table window will appear.&nbsp; Here is where we can specify the data type (Integer, double, float...)&nbsp;<br><br>If you can't get things imported from csv, download the portal_mammals.sqlite file from the Data page (<a href="http://emudrak.github.io/2015-01-15-cornell/data/biology/%29">http://emudrak.github.io/2015-01-15-cornell/data/biology/)</a>. Then, in SQLite, go to Database -&gt; Connect Database and click on the portal_mammals.sqlite.&nbsp;<br><br>Under
 Tables, You will see three lines: plots, species, surveys. Use the 
triangle to unfold this menu to look at the table headings in each 
file.&nbsp;<br><br>The species column in the surveys&nbsp;<br><br>Tab:&nbsp; Execute SQL.&nbsp; In the box under "Enter SQL" there will be an example query<br><br>SELECT year FROM surveys;&nbsp;<br><br>Click Run SQL.&nbsp; The window underneath shoudl show a bunch of years.<br><br>"SELECT"
 and "FROM" are command words, and are conventionally capitalized. 
"year" and "surveys" are columns from our tables, so we leave them 
lowercase.&nbsp; This is convention and for readability.&nbsp;<br><br><br>SELECT year, month, day FROM surveys;<br><br>Wildcards:&nbsp; will match anything.&nbsp; a "*" surves as our wildcard.&nbsp;<br><br>SELECT * FROM surveys<br><br>this will give us the entire table back.&nbsp;<br><br>to filter, use the keyword "DISTINCT"<br><br>SELECT DISTINCT species FROM surveys;<br><br>This will give only unique values.&nbsp;<br><br>SELECT DISTINCT year, species FROM surveys;<br><br>warning:
 this returns distinct pairs years and species. So you'll have duplicate
 years, but it's because they are with different species.&nbsp;<br><br>We can do a calculation on anything that is a number.&nbsp;<br><br>SELECT year, month, day, wgt/1000.0 FROM surveys;<br><br>SQLManager highlights derived properties- a brighter green. The derived column is named according to the cor<br><br>SELECT year, month, day, ROUND(wgt/1000.0 ,2) FROM surveys;<br><br>The
 derived column is named according to the formula.&nbsp; This is 
annoying to deal with later, so rename it in the same step:&nbsp;<br><br>SELECT year, month, day, ROUND(wgt/1000.0) AS wgtkg FROM surveys;<br><br>Challenge<b><i>: Write a query that returns the year, month, day, speciesID and weight in mg</i></b><br>SELECT year, month, day, species, wgt*1000 AS wgtmg from surveys;<br><br><b>Filtering&nbsp; with keyword WHERE</b><br><br>SELECT * FROM surveys WHERE species="DM";<br><br>SELECT * FROM surveys WHERE year &gt;= 2000;<br><br><b>combine selection criteria with AND and OR</b><br><br>SELECT * FROM surveys WHERE (year &gt;= 2000) AND (species = "DM");<br><br>SELECT * FROM surveys WHERE (year &gt;= 2000) AND (species = "DM") OR (species="DO") OR (species="DS");<br><br><b><i>EXERCISE:
 Write a query that returns The day, month, year, species ID, and weight
 (in kg) for individuals caught on Plot 1 that weigh more than 75 g</i></b><br><br>SELECT day, month, year, species, wgt FROM surveys WHERE (plot= 1) AND (wgt&gt; 75);<br><br>Click
 on surveys and look at the structure tab.&nbsp; You'll see the data 
type for plot is a number. So you don't need quotes around numerical 
values.&nbsp;&nbsp;<br><br><b>Exporting Tables</b><br>If we like this 
table, we can use the Actions button to save the results of this query 
as a .csv file.&nbsp; This is useful if your raw data is huge and you 
only want to use a smaller subset of it in an analysis program.<br><br><b>The IN operator</b><br>The chain&nbsp;<br>(species = "DM") OR (species="DO") OR (species="DS")<br>works fine, but we cna do this quicker with an IN operator<br><br>SELECT * FROM surveys WHERE (year&gt;=2000) and (species IN ("DM","DO","DS"))<br><br><b>Sorting with the ORDER keyword</b><br>SELECT * FROM species ORDER BY taxa ASC;<br>"ASC" means ascending - the default. If you dont put anything, it assumes this.&nbsp;<br>"DESC" means descending<br><br>Sort by multiple columns, with listed priority, from left to right in the written query.<br><br>SELECT * FROM species ORDER BY taxa ASC, genus ASC, species ASC;<br><br><br><b>Group records</b>&nbsp;<br><br>SELECT COUNT(*) FROM surveys;<br><br>gives row count of the entire table<br><br>SELECT COUNT(*), SUM(wgt) FROM surveys;<br><br>gives the row count and the total of the wgt column<br><br>SELECT ROUND(SUM(wgt)/1000.0, 3) FROM surveys;<br><br>SELECT species, COUNT(*) FROM surveys GROUP BY species;<br><br><b><i>Exercise: return the individuals counted/year and average weight/year</i></b><br><br>SELECT year, species, COUNT(species), ROUND(avg(wgt),2) FROM surveys GROUP BY year, species;<br><br>Sometimes it helps to separate a command like this by lines to make it more readable<br><br>SELECT year, species, COUNT(species), ROUND(avg(wgt),2)&nbsp;<br>FROM surveys&nbsp;<br>GROUP BY year, species;<br><br><br><b>Joining Tables&nbsp;</b><br>We know some of the data in species table relates to the data in the surveys tables<br><br>SELECT *&nbsp;<br>FROM surveys<br>JOIN species ON surveys.species=species.species_id;<br><br>The nomenclature:&nbsp; tableName.columnName<br>This is helpful because sometimes tables have the same column names.&nbsp;<br><br>If we want to select certain columns for this query, we must use this nomenclature:&nbsp;<br><br>SELECT surveys.year, surveys.month, surveys.day, species.genus, species.species<br>FROM surveys<br>JOIN species ON surveys.species=species.species_id;<br>(the ids are used to make sure they are corresponded between different databases)<br><br>SELECT plots.plot_type, AVG(surveys.wgt)<br>FROM surveys<br>JOIN plots&nbsp;<br>ON surveys.plot=plots.plot_id<br>GROUP BY plots.plot_type;<br><br><br><b>RStudio</b><br>Note about RStudio: your windows might not be in the exact same orientation as Erika's, but you should see four windows<br>The console is where code is actually entered and run<br>The
 script area is a place where we can record what we want to do. We can 
run these directly by hitting run (it'll send that line or whatever is 
highlighted to the console)<br><br>shortcut "&lt;-"------alt+"-"<br><br>To assign to a variable: weight_kg &lt;- 55<br>--- weight_kg is the name of our variable<br>--- 55 is the value we assigned to that object<br>You
 can think of a variable just like a variable in math: weight_kg 
represents whatever you've stored in it. eg: weight_kg*2 = 110<br><br>You can store variables in variables:<br>weight_lb &lt;- 2.2*weight_kg<br><br>If you now change weight_kg, it won't change weight_lb<br><br>weights &lt;- c(50, 60, 65, 82)<br>--- The c() stands for concatenate. This allows you to enter multiple values assigned to an object<br><br>We can convert all four of those weights to lbs at once:<br>weights_lb &lt;- 2.2*weights<br><br>You can also store non-numbers:<br>animals &lt;- c("mouse", "rat", "dog")<br><br>How many values are in my variable?<br>length(animals)<br>--- length will tell you how many values are assigned to that variable<br><br>weight &lt;- c(weights, 90)<br>---
 you can also add on to a vector using the c() command. This command 
takes the variable weights (which is (50, 60, 65, 82), and then adds 90 
to the end, resulting in (50, 60, 65, 82, 90)<br><br>How do you know whether your variable is a number or character vector?<br>class(weights)<br>"numeric"<br>class(animals)<br>"character"<br><br>R has many different types of variables:&nbsp;<br>1. numeric: these are numbers<br>2. intergers: whole numbers<br>3. logical: TRUE/FALSE<br>4. character: letters, letters and numbers<br><br><br><br>_______________________________________________________________________<br><b>Friday - 1/16/15</b><br>Good morning all!<br><br><b>R</b><br><br>Open up RStudio<br>File
 -&gt; New Project -&gt; New Directory -&gt; Empty Project -&gt; 
Directory name = "DC_Rproject", put that into Documents -&gt; Click 
create project<br><br>In the console, you can now see where your project
 is located on your computer (up in the console, it should say something
 like "~/DC_Erika/DC_Rproject"<br><br>Under Files, ask for a new Folder.
 Call it "data". If you look in your finder, you'll see that new folder 
in your computer.&nbsp;<br><br>Let's get some data: <a href="http://emudrak.github.io/2015-01-15-cornell/data/biology/">http://emudrak.github.io/2015-01-15-cornell/data/biology/</a>
 . Download surveys.csv, inflammation.zip, and DataWithZeros.xlsx. Put 
those in your newly made data folder. Put your blue stickies up when 
you've done that, put pink up if you need some help.<br><br>File -&gt; R Script<br><br>Let's load survey data into R:<br>surveys &lt;- read.csv("data/surveys.csv")<br><br>You should see in your "Environment" pane something called "surveys"<br><br>getwd() to get current directory<br><br>surveys<br><br>You
 should see a lot of stuff on the screen. It's a big table, so we can't 
see all of it in the console. In the "Environment" tab, there's a little
 grid next to "surveys". Click that and it'll bring up a spreadsheet 
like thing of the data<br><br>head(surveys)<br>This will list the first several lines of a table<br><br>R
 interprets this table as a "data.frame". In R, that means each column 
can have a different type of data (numeric, character strings, logical 
True/Falses, etc).&nbsp;<br><br>str(surveys)<br>This will show you the 
name of every column and what type of data it is (int = integer). Do 
this when you load up a table to make sure R is understanding your data 
correctly.&nbsp;<br><br>If you're loading data in general, you can use:<br>read.table("yourfile.txt", sep=",")&nbsp;<br>The
 "sep" thing here is where you signify whether it's comma delimited 
(","), tab ("\t"), or anything else, just put that in quotes.&nbsp;<br><br>Let's say we want to just look at one column of our data, year:<br>surveys$year<br>This will list every value in that column<br><br>dim(surveys) -&gt; shows dimensions of a data.frame<br>nrow(surveys) -&gt; how many rows are in my data.frame?<br>ncol(surveys) -&gt; how many columns are in my data.frame?<br>head(surveys) -&gt; shows first few lines of data.frame<br>tail(surveys) -&gt; shows last few lines of data.frame<br><br>names(surveys) -&gt; shows you the column names for surveys<br>summary(surveys) -&gt; shows you general summary information for each column (min, max, mean, etc)<br>class(surveys) -&gt; shows you what kind of object your variable is (in this case data.frame)<br><br>Challenge!<br>-What is the class of the object surveys?&nbsp;<br>A: class(surveys)&nbsp;<br>"data.frame"<br>-How many rows and how many columns are in this object?<br>A: nrow(surveys) ncol(surveys), dim(surveys), look in the environment pane, str(surveys)<br>-How many species have been recorded during these surveys?<br>A: str(surveys) (shows there are 49 levels for that variable), surveys$species (shows there are 49 levels)<br>-What is the range of years over which this data has been recorded?<br>A: summary(surveys$year), range(surveys$year)<br>-What is the mean weight of animals recorded?<br>A: summary(surveys$wgt)<br>Blue stickies up when you're done, red if you need a hand!<br>s<br><br>animals &lt;- c("mouse", "rat", "dog", "cat")<br>animals<br>(This will list all the animals)<br>What if we want to only look at say the second animal? We can "index" the second value using brackets:<br>animals[2]<br>or the fourth:<br>animals[4]<br>if you chose a number that's out of range you'll get an NA<br>animals[6]<br>If you want to get multiple values you can use the c() function we used yesterday. Say, the 2nd and 4th value:<br>animals[c(2,4)]<br>If you want a range, you can use ":" to specify values between two numbers. Say&nbsp; you want 2,3,4:<br>animals[2:4]<br>What
 if you want everything but the third value? The "-" sign will show 
everything but the index you're inputting. Say you want index 1,2,and4 
(not 3):<br>animals[-3]<br>If you have a data.frame, there are two dimensions: rows and columns. To reference 2 dimensions using indexing, it's always the <b>rows first, a comma, and then the columns</b>. If you only want to look at the first row:<br>surveys[1,]<br>If you only want to look at the first column:<br>surveys[,1]<br>If you want to look at only the first entry in the second column:<br>surveys[1,2]<br>You can use the ":" and "c()" in this as well. First three rows, columns 4-7:<br>surveys[1:3, 4:7]<br><br>Factors
 in R: when R inputs anything (using read.csv, read.table, etc) that has
 letters, it'll convert it to a factor. You can think of these like 
categories.&nbsp;<br>What different categories do we have (we call these levels):<br>levels(surveys$species)<br><br>How many levels does my factor have?<br>nlevels(surveys$species)<br><br>Sometimes
 we call our levels by a number and we don't want R to interpret it as a
 number. For example, the plots in our data. How can we <b>force</b> R to interpret something as a factor rather than a number?<br>as.factor(surveys$plot)<br>This will just print out surveys$plot as converted to factor, but it's not actually going to save it. To save it:&nbsp;<br>surveys$plot &lt;- as.factor(surveys$plot)<br>This
 is overwriting this column as now recognizing it as a factor. This is 
only changing the data in R itself. Your actual data file won't be 
changed.&nbsp;<br>A bit of a kink with factors: even if you call your 
levels a word, R "thinks" about factor levels as numbers. We won't talk 
about this further, but just keep this in the back of your head for when
 you're working in R. Sometimes this can crop up when you're doing data 
analysis in ways you weren't expecting.&nbsp;<br><br>Comment character "#"<br>Anything
 written after a "#" on a given line will not be interpreted by R. This 
is a way to document your code. Use them often! Don't trust that future 
you will remember current-you's logic!<br><br>Let's add a&nbsp; comment to our script about what we're doing:<br># Subsetting data frame<br><br>subset(surveys, species=="DO")<br>What
 is this doing? We are taking a subset of the dataframe surveys, where 
we're only looking at entries where species is DO. The "==" is R speak 
for "is equal to". A single = will not do this (it is actually the same 
as the assignment operator, &lt;-)&nbsp;<br><br>What we wrote above will print it out to the console. We want to save that, let's assign it to a variable:<br>surveys_DO &lt;- subset(surveys, species=="DO")<br><br>Can we do a subset of "this OR that"?&nbsp;<br>surveys_DO &lt;- subset(surveys, (species=="DO") | (species=="AB"))<br><br>What
 happens when you see a "+" at the beginning of the line? That means you
 haven't finished your statement. Check your parenthases, quotes, etc. 
Make sure you've closed everything!<br><br>In R, to say "OR", use the "|" symbol (above your enter key, hit shift)<br>If you want to say "AND", use "&amp;"<br><br>What
 if you want to look at everything BUT some value? You can use "!=". 
This means "not equal to". So if we want to look at everything but DO:<br>surveys_notDO &lt;- subset(surveys, species != "DO")<br><br>What if we want to look at only some of the columns while subsetting on DO?<br>DO_weights &lt;- subset(surveys, species == "DO", select=c("sex", "wgt"))<br>This is saying, we're subsetting from surveys the columns sex and weight for only the species that are labeled DO<br><br>How to get function help in R: question mark and then name of function<br>?subset<br><br>This
 will pop up a help window in a frame in Rstudio. Some helpful things to
 look at: the arguments descriptions and details. At the bottom there 
are usually examples of how to use the function, but honestly I find 
those usually aren't very helpful!&nbsp;<br><br>Little tip about 
arguments for function in R: if you specify the argument name, you can 
input things in any order into the funciton when you call it.&nbsp;<br><br>COFFEEE! Be back by 10:40 please.&nbsp;<br><br>Clean environment occasionally to make sure you will not use a mistaken object.<br><br>When
 we're working with R, what we want to do is build scripts. These 
scripts contain a list of all commands we need to run to get a result. 
You should be able to give your data and a script to your colleague and 
they should be able to run the exact same analysis that you did.&nbsp;<br><br>Challenge:&nbsp;<br><br>2. What is the range (minimum and maximum) weight?<br>A. min(surveys_complete$wgt) max(surveys_complete$wgt)<br>3. What is the median weight for the males?<br>A. temp &lt;- subset(surveys_complete, sex="M", select=wgt)<br>median(temp$wgt)<br>answer 2: median(subset(surveys_complete, sex=="M")$wgt)<br>answer 3: median(surveys_complete[surveys_complete$sex=="M", "wgt"])<br>Blue sticky up when you're done, pink if you need help.<br><br><br># tapply(columns to calculate on, factors to group on, function)&nbsp;<br>Apply
 statements are a fast way to do the same thing over and over to each 
row or column in a dataframe, item in a list, etc. tapply specifically 
will perform any function you specify on the columns you specify, 
grouping by the factor you specify.&nbsp;<br><br>specieswgts &lt;- tapply(surveys_complete$wgt, surveys_complete$species, mean)<br><br>#STOP###<br><br>Group the commands that we actually need to build the objects that we are working with :&nbsp;<br><br>#This is all I really need.&nbsp;<br><br>surveys &lt;- read.csv("data/surveys.csv")<br>surveys$plot &lt;- as.factor(surveys$plot)<br>surveys$logwgt &lt;- log(surveys$wgt)<br>surveys_complete &lt;- surveys[complete.cases(surveys), ]<br>surveys_complete &lt;- droplevels(surveys_complete)<br>specieswgts &lt;- tapply(surveys_complete$wgt, surveys_complete$species, mean)<br><br>barplot(specieswgts, cex.names=0.5, horiz=TRUE, las=1)<br><br><br>jpeg(filename="species_mean_wgts.jpg", width=400, height=500)<br>barplot(specieswgts, cex.names=0.5, horiz=TRUE, las=1, main="Mean weight per species", xlab="weight in kg", ylab="species")<br>dev.off()<br><br><br><br>Challenge:<br>Calculate the maximum animal weight in each plot<br><br>A. tapply(surveys_complete$wgt, surveys_complete$plot, max)<br><br>Let's plot!<br><br>barplot(specieswgts)<br>This will show up in your plot section. Barplot will plot each level on the x-axis, and the value on the y-axis.&nbsp;<br><br>On our plot, our labels are too big and they aren't all showing up.&nbsp;<br>If we look in&nbsp;<br>?barplot<br><br>cex.names will alter the size of the labels essentially<br>barplot(specieswgts, cex.names=0.8)<br><br>Still not small enough<br><br>barplot(specieswgts, cex.names=0.5)<br><br>Something
 to note about the helpfile: you'll see that the arguments are assigned 
defaults. If you don't specify an argument, it will specify a default 
for any argument that has defaults specified. If you look at barplot, 
height does NOT have anything for a default value. If you don't enter 
anything for height, it won't know what to do and throw an error.&nbsp;<br><br>What if we want the bars coming off of the y-axis:<br>barplot(specieswgts, cex.names=0.5, horiz=TRUE)<br><br>Now the labels aren't right side up though. We can rotate those using "las"<br>barplot(specieswgts, cex.names=0.5, horiz=TRUE, las=1)<br><br>When you're plotting, always put a title and axes labels on your graph!&nbsp;<br>You can specify a title using the "main" parameter, and the x axis with "xlab", and the y axis with "ylab"<br><br>You can save these images from R script using export -&gt; Save Plot as Image.&nbsp;<br><br>However, you can also save things using a command. You can save things to a jpeg:<br><br>jpeg(filename="species_mean_wgts.jpg", width=400, height=500)<br>barplot(specieswgts, cex.names=0.5, horiz=TRUE, las=1, main="Mean weight per species", xlab="weight in kg", ylab="species")<br>dev.off()<br><br>What
 happens here is that the jpeg commands opens a connection to a new file
 called species_mean_wgts on your computer. Any command you type after 
that, if it produces an image/plot/bargraph/whatever will output that to
 the file rather than the little window in the bottom of the RStudio. 
You need to close the connection to this file when you're done writing 
things out using dev.off(). This stands for device off and it just means
 it's closing this connection. Note: if you do something like this:<br>jpeg("file.jpg")<br>bargraph(specieswgts)<br>bargraph(specieswgts*2)<br>dev.off()<br><br>It
 will only display the second graph. You essentially write over your 
first graph. Either you need to save them as separate files or you need 
to specify you're going to print more than one graph to your file (we 
won't cover that here).&nbsp;<br><br><br><br><br><br><b>Afternoon</b><br><br>We're going to continue working in R, but close out and reopen to refresh the program.&nbsp;<br>Unzip inflammation.zip files:<br>Windows: right click, extract all, when it shows the file name, delete where it says inflammation<br>On
 Mac, double click it, but you'll have to move the individual files back
 up to the data folder, rather than where you're sitting in the 
inflammation folder. Delete the empty inflammation folder.&nbsp;<br><br>Each row is a patient, each column is a day<br><br>Each
 file has the same format, so we can set up an analysis to streamline 
analyzing all of these files, rather than analyzing each one by hand 
individually.<br><br>Challenge: read inflammation-01.csv into dat<br><br>dat &lt;- read.csv(file = "data/inflammation-01.csv", header=FALSE)<br><br>class(dat)<br>nrow(dat)<br>ncol(dat)<br>dat[30,20]<br><br>apply() # This will apply a function multiple times to a dataframe<br><br>apply(dat, MARGIN=1, mean) # The mean inflammation for each patient over the experiment<br>This is saying for each row in dat, find the mean. If you want to do that with the columns, you can do:<br>apply(dat, MARGIN=2, mean) # The mean inflammation over all patients for each day of the experiment&nbsp;<br><br>avg_day_inflam &lt;- apply(dat, MARGIN=2, mean)<br><br>plot(avg_day_inflam) # gives us a little scatter plot where the day is along the X, the average is along the Y axis<br><br>This plotted little circles, but maybe we want a line:<br>plot(avg_day_inflam, type="l")<br><br>max_day_inflam &lt;- apply(dat, MARGIN=2, max)<br>min_day_inflam &lt;- apply(dat, MARGIN=2, min)<br><br>plot(min_day_inflam, type="l")<br>plot(max_day_inflam, type="l")<br><br>Let's rearrange our script so that it's more organized:<b> If you're behind copy these into your script:</b><br>dat &lt;- read.csv(file = "data/inflammation-01.csv", header=FALSE)<br><br>avg_day_inflam &lt;- apply(dat, MARGIN=2, mean)<br>max_day_inflam &lt;- apply(dat, MARGIN=2, max)<br>min_day_inflam &lt;- apply(dat, MARGIN=2, min)<br><br>plot(avg_day_inflam, type="l")<br>plot(min_day_inflam, type="l")<br>plot(max_day_inflam, type="l")<br><br>Let's re-run all of this stuff.<br>What if you want to see all of these plots at once?<br>par(mfrow=c(1,3))<br>plot(avg_day_inflam, type="l")<br>plot(min_day_inflam, type="l")<br>plot(max_day_inflam, type="l")<br><br>Let's reset that par, since we might not always want three graphs right next to each other:<br>par(mfrow=c(1,1))<br><br>How can we save a jpeg imagine of these plots?<br>jpeg("daily-inflammation.jpg", height=300, width=600)<br>par(mfrow=c(1,3))<br>plot(avg_day_inflam, type="l")<br>plot(min_day_inflam, type="l")<br>plot(max_day_inflam, type="l")<br>par(mfrow=c(1,1))<br>dev.off()<br><br>Run this. Once you have this 3 panel plot saved into your folder put your stickies up!<br><br>Great, so we analyzed inflammation-01.csv, but now let's do all of this for inflammation-02.csv<br><br>filename &lt;- "data/inflammation-02.csv"<br>picname &lt;- "daily-inflammation-02.jpg"<br><br>analyze &lt;- function(filename, picname) {<br>&nbsp;&nbsp;&nbsp; dat &lt;- read.csv(filename, header=FALSE)<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; avg_day_inflam &lt;- apply(dat, MARGIN=2, mean)<br>&nbsp;&nbsp;&nbsp; max_day_inflam &lt;- apply(dat, MARGIN=2, max)<br>&nbsp;&nbsp;&nbsp; min_day_inflam &lt;- apply(dat, MARGIN=2, min)<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; jpeg(picname, height=300, width=600)<br>&nbsp;&nbsp;&nbsp; par(mfrow=c(1,3))<br>&nbsp;&nbsp;&nbsp; plot(avg_day_inflam, type="l")<br>&nbsp;&nbsp;&nbsp; plot(min_day_inflam, type="l")<br>&nbsp;&nbsp;&nbsp; plot(max_day_inflam, type="l")<br>&nbsp;&nbsp;&nbsp; par(mfrow=c(1,1))<br>&nbsp;&nbsp;&nbsp; dev.off()<br>}<br><br>analyze(filename="data/inflammation-03.csv", picname="daily-inflammation-03.jpg")<br><br><br>For Loops:<br>Generally, for loops do the following:<br>FOR everything in my collection, do something I want you to do.<br><br>for (i in 1:10) {<br>&nbsp;&nbsp;&nbsp; sq &lt;- i^2<br>&nbsp;&nbsp;&nbsp; print(paste("The square of", i, "is", sq))<br>}<br><br>aside
 about paste(): paste automatically puts a space wherever you've put a 
comma in your string of things you want to paste together. You have 
designate something other than a space by using sep="" and put whatever 
in between "". say a dash:&nbsp;<br>paste("The squre of",i,"is",sq, sep="-")&nbsp;<br>will look something like:<br>The square of-1-is-1<br><br>list.files(recursive=TRUE) # This will give a list of all the files that are in all the folders in the current working directory<br><br>Maybe you don't want all the files, maybe you only want to look at files that are comma separated:&nbsp;<br><br>filelist &lt;- list.files(pattern="inflammation-.csv", recursive=TRUE)&nbsp;<br><br>for (f in 1:length(filelist)) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; analyze(filename=filelist[f], picname=paste("daily-inflam",f,".jpg", sep=""))<br>}<br><br><br>So, the entire bunch of code that we'll need is below:&nbsp;<br><br><br>analyze &lt;- function(filename, picname){<br><br>dat &lt;- read.csv(filename, header=FALSE)<br><br>avg_day_inflam &lt;- apply(dat, MARGIN=2, mean )<br>max_day_inflam &lt;- apply(dat, MARGIN=2, max)<br>min_day_inflam &lt;- apply(dat, MARGIN=2, min)<br><br>jpeg(picname, height=300, width=600)<br>par(mfrow=c(1,3))<br>plot(avg_day_inflam, type="l")<br>plot(min_day_inflam, type="l")<br>plot(max_day_inflam, type="l")<br>par(mfrow=c(1,1))<br>dev.off()<br>}<br><br>filelist &lt;- list.files(pattern="inflammation-", recursive=TRUE)<br><br>for (f in 1:length(filelist)){<br>&nbsp; analyze(filename=filelist[f], picname=paste("daily-inflam", f, ".jpg", sep=""))<br>}<br><br><br><br><br><br><br><br><br>############ Command Line Lesson #######################<br><br>PATH=$PATH:"C:\Program Files\R\R-3.1.1\bin\x64"<br><br><br><br>PATH=$PATH:"C:\Program Files\R\R-3.1.1\bin\x64"<br><br>To check this worked, type "Rscript" and you should get the bunch of text on the screen<br><br>Tools up until now: point &amp; click<br>Many of the commands we have used can be tied together with the command line<br><br><br>Work on "<b>bash</b>" for this.&nbsp; Windows needs to download it through Git, Mac has it already installed.&nbsp;<br>This is what you use to access computer clusters on campus (if you do that...)<br><br>We can move around in our folders in bash just like do in our windows browser<br><br>DO THIS: Go to downloads page<br>(<a href="http://emudrak.github.io/2015-01-15-cornell/data/biology/%29">http://emudrak.github.io/2015-01-15-cornell/data/biology/)</a>,<br>&nbsp;get "filesystem.zip", put it on desktop and unzip it.&nbsp;<br><br>Put up sticky once you have this downloaded and unpacked<br><br>whoami<br><br>pwd - "present working directory" - where you are "sitting' right now<br><br>cd - "change directory"<br><br>ls - "listing" lists all the files in the directory right now<br><br>ls -F&nbsp;<br>shows which is a file and which is a Folder.&nbsp; Folders have "/" after them.<br><br>move into the filesytem folder:&nbsp;<br>cd filesystem<br><br>Everything
 you see in the command line should mirror everything you see in the 
windows explorer when you click through folders (like you probably are 
used to doing).<br><br>Let's look at the users folder:&nbsp;<br><br>cd users<br><br>Now the path has changed to say "~/Desktop/filesystem/users"<br><br>ls<br>You should see&nbsp; "backup" "nelle" "thing"<br><br>Moveinto the "nelle" folder<br><br>cd nelle<br><br><b>Bash shortcuts:&nbsp;</b><br><br>"Tab completion"<br>If
 you want to look in the folder "north-pacific-gyre", but you are likely
 to make typos. With tab completion, you are able to start writing the 
thing and press "tab" and it will complete it with the rest of the line 
if you can.<br><br><br>cd&nbsp;<br>will take you all the way to the home directory<br><br>full path vs. relative path<br>full path is being very explicit from home directory&nbsp;<br>"c:/users/elm26/Documents/MyAnalysis"&nbsp;<br>THe home directory is sometimes abbreviated by "~"<br>a relative path is instructions from where you are sitting right now.&nbsp;<br>relative
 paths make it easier to move a bunch of files in a complicated folder 
structure between users.&nbsp; You could put the outermost folder on a 
thumbdrive nad give it to your friend, and all the relative paths would 
still work.&nbsp;<br><br>"Up directory"<br>cd ..<br>Will back up one directory from where you are.&nbsp; "Back up" or move outwards, etc...<br><br>Discussion of File organization<br>have different folders for different distinct data types, stages of analysis, etc...<br><br>Just like you can make new folders in the graphical windows&nbsp;<br><br>put yourself in the "nelle" directory<br><br>make a new folder within this folder, call it thesis.&nbsp; This command is "mkdir"<br><br>mkdir thesis<br><br>now look in your graphical windows broswer. You should see a new folder named thesis.&nbsp;<br><br>We are going to write some text files for this directory using nano,, which is a simple text editor<br><br>type<br>nano draft.txt<br><br>you'll get into another window that is the text editing window with the heading "draft.txt" at the top.&nbsp;<br><br>type
 something in here.&nbsp; then press control X to get out of the nano 
program.&nbsp; It will ask you if you wanted to save.&nbsp;<br><br>now youre back int the shell,<br>type<br>ls<br>and you will see the new draft.txt file that you just made<br><br>remove a file with&nbsp;<br>rm draft.txt<br>**** WARNING **** THis will delete it FOREVER - there is no recycle bin here!<br><br><br>cat will print out the start of the file&nbsp;<br><br><br>make an original draft&nbsp; (draft.txt)<br><br>Copy it and name it sometihng else&nbsp;<br><br>cp draft_v1.txt draft_v2.txt<br><br>open this new file and change something about it<br>nano draft_v2.txt<br><br>type ls to see both the original file and the new file<br><br><br>back up into the nelle folder<br>cd ..<br><br>move into the molecules folder<br><br>cd molecules<br><br>ls<br><br>you shoudl see a bunch of files<br><br>wc cubane.pdb<br><br>wc - "word count" will show the word count- how many lines and words are in teh file.&nbsp;<br><br>use the wildcard character "*" to represent any character<br><br>so then&nbsp;<br>wc *.pdb<br><br>will print out the word count for anything that matches ends with .pdb.&nbsp;&nbsp;<br><br>wc p*<br>will print out the word count for anyting that starts iwth "p"<br><br>Right
 now, everything that we are doing is just printing on the screen and 
not being saved anywhere.&nbsp; You can redirect this output to another 
file with the "&gt;" command<br><br>wc *.pdb &gt; word_counts.txt<br><br>Now instead of printing on the screen, it will put the output into the file word_counts.txt<br><br>### Pipes ####<br>The
 power of using command line is stringing a bunch of commands 
together.&nbsp; This is done with the "pipe" or "bar" character, which 
is above the enter key, to the right of the "]" hey, and you need shift 
to get to it.&nbsp;<br><br>head cubane.pdb<br>shows the top part, just like in R<br><br>pipe "head" together with "wordcount":&nbsp;<br><br>head cubane.pdb | wc<br>this will string the commands together, so it will take the head of cubane.pdb and then do the word count of that.&nbsp;&nbsp;<br><br><b>For loops in bash</b><br><br><br>&nbsp;for i in *.pdb<br>&nbsp;do<br>&nbsp;echo $i&nbsp;&nbsp;&nbsp;<br>&nbsp;done<br><br>Now we are entering more than one line at once, and the prompt changes form $ to &gt;<br>the start of the loop is "do" and the end of the loop is "done", similar to the { and } brackets in R<br><br>Let's do sometihng more complcetaed<br><br>$ for in in *.pdb<br>do<br>echo $i<br>wc $i<br>done<br><br><br>this is useful if you have 20 data files and you want to do the same operation to all of them<br><br>ls .. get back to the upper level and show the listed things<br><br><br>Now
 go to homepage to the Schedule.&nbsp; Under Worksflwos and Automating 
Tasks in the shell is a link to the notes that we used&nbsp;<br><br>Get to 6. Command Line programs This has some notes that you will need to use.&nbsp;<br><br>cd into your data folder from this morning&nbsp;<br><br>cd ~/Documents/DC_Erika/DC_Rproject/data&nbsp;&nbsp;&nbsp;<br>... or something similar....<br><br>make sure you can see all the inflammation files when you type&nbsp;<br>ls<br><br>back slash "\" can be used to escape the space in a file name<br><br>Now follow along on this webpage: <a href="http://emudrak.github.io/2015-01-15-cornell/lessons/shell/07-cmdline.html">http://emudrak.github.io/2015-01-15-cornell/lessons/shell/07-cmdline.html</a><br><br>head -4 inflammation-10.csv | Rscript readings.R --min<br><br>########### How to write an R script in Bash ############<br>be in the data folder<br><br>nano session-info.R<br><br>Now we have a nano window where we are writing into our file called "session-info.R"<br>Into this, type&nbsp;<br><br>sessionInfo()<br><br>Save using Ctrl-O, and then exit nano with Ctrl-x<br><br>ls<br>you shoudl now see a "session-info.R"<br><br>cat session-info.R<br><br>Rscript session-info.R<br><br><br>Create a new script called "print-args.R"<br><br>nano print-args.R<br>-------- in nano type...----------<br># Comments are put after the pound symbol, just like in R Studio<br>args &lt;- commandArgs()<br>cat(args, sep="\n")<br>--------------------------------<br><br>Save using Ctrl-O, and then exit nano with Ctrl-x<br><br>now, back in bash,&nbsp;<br>ls<br>you should see the print-args.R<br><br>Rscript print-args.R<br><br>Rscript print-args.R cat dog mouse<br><br>hide the weird R stuff -lets edit our R script to hide those<br><br>nano print-args.R&nbsp;<br><br>-------- in nano edit the file...----------<br># Comments are put after the pound symbol, just like in R Studio<br>args &lt;- commandArgs(trailingOnly=TRUE)<br>cat(args, sep="\n")<br>--------------------------------<br><br><br>Save using Ctrl-O, change the file naem and type "print-args-trailing.R" and then exit nano with Ctrl-x<br><br>Rscript print-args-trailing.R otter unicorn monkey<br><br>Make anew file in nano<br><br>-------- in nano type..----------<br>main&lt;- function(){<br>&nbsp;&nbsp;&nbsp; args &lt;- commandArgs(trailingOnly=TRUE)<br>&nbsp;&nbsp;&nbsp; filename &lt;- args[1]<br>&nbsp;&nbsp;&nbsp; dat &lt;- read.csv(file=filename, header=FALSE)<br>&nbsp;&nbsp;&nbsp; mean_per_patient &lt;- apply(dat, MARGIN=1, mean)<br>&nbsp;&nbsp;&nbsp; cat (mean_per_patient, sep="\n")<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>main()<br><br><br>--------------------------------<br><br>Save using Ctrl-O, save it as "readings-01.R" and then exit nano with Ctrl-x<br>".R" is extension for all R scripts<br><br>make sure the "readings-01.R" file is in the directory when you print 'ls"<br><br>Try running this script with the first inflammation file:&nbsp;<br><br>Rscript readings-01.R inflammation-01.csv<br><br>now set it up so that that information is written to another file using &gt;<br><br>Rscript readings-01.R inflammation-01.csv &gt;inflammation-01-csv.out<br><br>You can also do this in a for-loop!<br><br>for i in *.csv&nbsp;<br>do&nbsp;<br>echo $i<br>done<br><br>hmm... this shows too many files edit this little script....&nbsp; now use&nbsp;<br>i*.csv<br>to show anything that starts with "i" and ends in ".csv"<br><br>for i in i*.csv&nbsp;<br>do&nbsp;<br>echo $i<br>done<br><br>now do it for the R script we just wrote...<br>To change the file names in a batch<br>for i in i*.csv<br>do<br>echo $i<br>Rscript readings-01.R $i &gt; $i.out<br>done<br><br><br><br><br>up and down arrow to show past typed commands<br>"history" to show the typed commands<br><br><br>mv draft.txt thesis/<br>mv draft.txt draft_v1.txt<br><br><br><br><br><br><br><br>

</body></html>